---
import { Icon } from 'astro-icon/components';
import type { CollectionEntry } from 'astro:content';

interface Props {
  talk: CollectionEntry<'talks'>;
}

const { talk } = Astro.props;

function formatDate(date: Date): string {
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<article class="group h-full">
  <div
    class="flex h-full flex-col rounded-xl overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    style="background-color: var(--color-surface-elevated); border: 1px solid var(--color-border); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);"
  >
    <!-- Slides Embed -->
    {talk.data.slidesEmbedUrl && (
      <div class="relative w-full" style="padding-top: 56.25%;">
        <iframe
          src={talk.data.slidesEmbedUrl}
          class="absolute inset-0 size-full"
          allowfullscreen
          loading="lazy"
          style="border: 0;"
        ></iframe>
      </div>
    )}

    <div class="p-6 flex flex-col flex-1">
      <!-- Title -->
      <h3
        class="text-xl font-bold mb-4 transition-colors group-hover:gradient-text"
        style="color: var(--color-text-primary); letter-spacing: -0.025em; line-height: 1.3;"
      >
        {talk.data.title}
      </h3>

      <!-- Meta Info -->
      <div class="mt-auto space-y-3">
        <!-- Event & Location in one line -->
        {(talk.data.event || talk.data.location) && (
          <div class="flex items-center gap-3 flex-wrap text-sm" style="color: var(--color-text-secondary);">
            {talk.data.event && (
              <div class="flex items-center gap-1.5">
                <Icon name="lucide:calendar-days" class="size-4" style="color: var(--color-primary);" />
                <span class="font-medium">{talk.data.event}</span>
              </div>
            )}
            {talk.data.location && (
              <div class="flex items-center gap-1.5">
                <Icon name="lucide:map-pin" class="size-4" style="color: var(--color-accent);" />
                <span class="font-medium">{talk.data.location}</span>
              </div>
            )}
          </div>
        )}

        <!-- Action Buttons -->
        {((talk.data.slidesUrl && !talk.data.slidesEmbedUrl) || talk.data.videoUrl) && (
          <div class="flex flex-wrap gap-2 pt-1">
            {talk.data.slidesUrl && !talk.data.slidesEmbedUrl && (
              <a
                href={talk.data.slidesUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-semibold transition-all hover:scale-105 hover:shadow-md"
                style="background: var(--gradient-primary); color: white;"
              >
                <Icon name="lucide:presentation" class="size-4" />
                Slides
              </a>
            )}
            {talk.data.videoUrl && (
              <a
                href={talk.data.videoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-semibold transition-all hover:scale-105 hover:shadow-md"
                style="background: var(--gradient-accent); color: white;"
              >
                <Icon name="lucide:video" class="size-4" />
                Video
              </a>
            )}
          </div>
        )}
      </div>
    </div>
  </div>
</article>
