---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import TalkListItem from '../components/TalkListItem.astro';

const allTalks = await getCollection('talks');

// 日付順にソート（新しい順）
const sortedTalks = allTalks.sort((a, b) =>
  b.data.date.getTime() - a.data.date.getTime()
);

// 年ごとにグループ化
const talksByYear = sortedTalks.reduce((acc, talk) => {
  const year = talk.data.date.getFullYear();
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(talk);
  return acc;
}, {} as Record<number, typeof sortedTalks>);

const years = Object.keys(talksByYear).map(Number).sort((a, b) => b - a);
---

<Layout title="Talks" description="登壇資料やプレゼンテーションのまとめ">
  <div class="mx-auto px-4 py-16" style="max-width: var(--container-max);">
    <section class="mx-auto" style="max-width: 1200px;">
      <!-- Hero Section -->
      <div class="mb-16 text-center">
        <h1 class="gradient-text mb-6 text-6xl font-extrabold" style="letter-spacing: -0.03em;">
          Talks
        </h1>
        <p class="mx-auto max-w-2xl text-xl" style="color: var(--color-text-secondary);">
          登壇資料やプレゼンテーションのまとめ
        </p>
      </div>

      {sortedTalks.length > 0 ? (
        <div class="space-y-16">
          {years.map((year) => (
            <section>
              <h2 class="gradient-text mb-8 text-4xl font-extrabold" style="letter-spacing: -0.02em;">
                {year}
              </h2>
              <div class="grid gap-6 md:grid-cols-2">
                {talksByYear[year].map((talk) => (
                  <TalkListItem talk={talk} />
                ))}
              </div>
            </section>
          ))}
        </div>
      ) : (
        <p class="text-center text-lg" style="color: var(--color-text-secondary);">
          No talks yet. Check back soon!
        </p>
      )}
    </section>
  </div>
</Layout>
